<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/analytics.css">
    <title>Document</title>
    <script src="https://cdn.plot.ly/plotly-2.18.2.min.js"></script>
</head>
<body>
    <main>
      <div class="banner"> 
        <a href="/clock" > <button class="logout-button"> Go Back </button></a>
        <a href="/logout" > <button class="logout-button"> Log Out </button></a>
      </div>
        <div class="analytics-container">
            <h1 class="analytics-title">Your Pomodoro Wrapped!</h1>
          
            <% if (message) { %>
              <div class="analytics-section">
                  <p class="error-message"><%= message %></p>
              </div>
          <% } else { %>
              <div class="analytics-section">
                  <h2 class="analytics-subtitle">Usage Summary</h2>
                  <p>You have been productive for a total of <span class="stat"><%= data.totalPomoHours.toFixed(1) %></span> hours.</p>
                  <p>Your focus has <%= data.focusChange === 1 ? 'increased' : 'decreased' %> by <span class="stat"><%= data.focusPercentage.toFixed(2) %>%</span> this week.</p>
                  <p>You took <span class="stat"><%= data.lastWeekBreakHours.toFixed(1) %></span> hours of breaks this week. Stay rejuvenated!</p>
              </div>
  
              <div class="analytics-section">
                  <h2 class="analytics-subtitle">Your Week in Pomodoros</h2>
                  <div id="weeklyProgressChart" style="width:600px;height:250px;"></div>
              </div>
  
              <div class="analytics-section">
                  <h2 class="analytics-subtitle">Focus Heatmap</h2>
                  <div id="pomodoro-heatmap"></div>
              </div>
          <% } %>
      </div>
    </main>
    <script>
        const weeklyProgressData =  <%- JSON.stringify(data.weeklyProgressData) %>;

        Plotly.newPlot('weeklyProgressChart', [
            {
                x: weeklyProgressData.map(row => row.day),
                y: weeklyProgressData.map(row => row.mins),
                type: 'bar'
            }
        ], {
            title: 'Weekly Progress',
            xaxis: { title: 'Day' },
            yaxis: { title: 'Minutes focused' }
        });
    </script>
</body>
</html>